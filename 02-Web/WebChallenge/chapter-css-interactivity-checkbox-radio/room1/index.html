<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Interactivity Room 1 - Checkbox Toggle</title>
    <link rel="stylesheet" href="../../game-styles.css">
</head>
<body>
    <div id="game-container"></div>

    <script src="../../progress.js"></script>
    <script src="../../game-engine.js"></script>
    <script>
        startRoom({
            chapterId: 'chapter-css-interactivity-checkbox-radio',
            roomId: 'room1',
            title: 'ðŸ”“ Checkbox Toggle',
            description: 'Learn to use :checked pseudo-class for interactivity',
            instructions: `Make the door turn green when the checkbox is checked! Use the <code>:checked</code> pseudo-class with a sibling selector (<code>~</code>) to change the door's background color.`,

            htmlEditable: false,
            cssEditable: true,

            initialHTML: `<div class="toggle-container">
    <label class="toggle-label">
        <input type="checkbox" class="toggle-checkbox">
        <span class="toggle-text">Turn the key</span>
    </label>

    <div class="door">
        <span class="door-status">Locked</span>
    </div>
</div>`,

            initialCSS: `/* Make door green when checkbox is checked */
.toggle-container {
    text-align: center;
    padding: 30px;
}

.toggle-label {
    display: block;
    margin-bottom: 20px;
    cursor: pointer;
    font-size: 18px;
}

.toggle-checkbox {
    width: 20px;
    height: 20px;
    margin-right: 10px;
}

.door {
    width: 150px;
    height: 200px;
    background: #e74c3c;
    margin: 0 auto;
    border-radius: 8px 8px 0 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s;
}

.door-status {
    color: white;
    font-weight: bold;
    font-size: 18px;
}

/* Add :checked rule to change door color */
`,

            hints: [
                'Use the sibling selector: <code>.toggle-checkbox:checked ~ .door</code>',
                'Change the background: <code>background: #27ae60;</code>',
                'The ~ selector targets siblings that come after the element'
            ],

            validate: function({ doc, css }) {
                // Check if CSS contains :checked
                if (!css.includes(':checked')) {
                    return { success: false, message: 'Add a :checked pseudo-class rule!' };
                }

                // Check for sibling selector
                if (!css.includes('~')) {
                    return { success: false, message: 'Use the sibling selector (~) to target the door!' };
                }

                // Programmatically check the checkbox and verify color changes
                const checkbox = doc.querySelector('.toggle-checkbox');
                const door = doc.querySelector('.door');

                if (!checkbox || !door) {
                    return { success: false, message: 'Elements not found!' };
                }

                checkbox.checked = true;
                checkbox.dispatchEvent(new Event('change'));

                const style = doc.defaultView.getComputedStyle(door);
                const bgColor = style.backgroundColor;
                const rgb = bgColor.match(/\d+/g);

                // Check for greenish color
                if (rgb && parseInt(rgb[1]) > parseInt(rgb[0]) && parseInt(rgb[1]) > parseInt(rgb[2])) {
                    return { success: true };
                }

                return { success: false, message: 'The door should turn green when checked!' };
            }
        });
    </script>
</body>
</html>
